- ut start 最终会执行 packages/x 中的 start
- `tsx ./scripts/set-node-options.ts cross-env PORT=8001 dumi dev`

## tsx 是什么？

- 运行 ts 代码的执行器。
- tsc 一般把 ts 转 js，你再 node 运行，而使用 tsx 可以直接运行 ts 代码
- `tsx watch your-script.ts` 启动监听模式

```
你的 TypeScript 文件 (app.ts)
         |
         v
      tsx 运行时
   （内部使用 ESBuild）
         |
         v
内存中的 JavaScript 代码
         |
         v
      Node.js 执行
```

## scripts/set-node-options.ts 的作用？

- 一个启动项目的时候，分配内存的脚本

- NODE_OPTIONS
  - NODE_OPTIONS 是 Node.js 在启动时会自动读取的一个标准环境变量。
  - 当你设置 NODE_OPTIONS 后，Node.js 会在启动时自动应用这些选项，就像你在命令行中直接传递参数一样。
  - 它专门用于传递 Node.js 运行时自身的命令行选项，所以你**不能自定义参数**
  - 你可以用它来设置垃圾回收、内存限制、调试等多项运行时配置
  - 例如:

  ```bash
  # 指定内存大小
  NODE_OPTIONS='--max-old-space-size=4096' node app.js
  # 等价于
  node --max-old-space-size=4096 app.js
  ```

  - `--max-old-space-size` 设置V8引擎老生代内存上限。用于解决“JavaScript堆内存不足”错误

- 子进程会继承父进程的环境变量，所以子进程也会自动读取 NODE_OPTIONS。

## Dumi

- Dumi 是一个静态站点构建工具（SSG），专门用于构建组件文档网站。
- Dumi 负责把 Markdown 文件转译为 HTML 文件
- 将生成的 HTML 文件托管到静态服务器上
- **重点：Dumi 静态站点构建**
  - 也就是说，Dumi 只负责把 Markdown 文件转译为 HTML 文件，然后把 HTML 文件托管到静态服务器上。
- SSR 可以区分为运行时的SSR和构建时的SSR
  - 运行时的SSR：在浏览器中执行，如 React SSR
  - 构建时的SSR：在构建时执行，如 Next.js SSR
  - SSG = Build-time SSR
  - 虽然叫 "静态站点生成"，但本质上是在构建时进行服务端渲染
- **SSG 本质上是在构建时进行的服务端渲染(SSR)!**
  - 所以你能在 Dumi 的配置中看到 `ssr: true` 的配置，以及针对 SSR 的优化。
- 传统 SSR: 请求 → Node.js 渲染 → 返回 HTML
- SSG: 构建时 → Node.js 渲染 → 生成静态 HTML 文件

## 切割css的好处

更灵活的缓存策略：可以跨页面共享样式更好的性能：避免在每个页面重复内联相同的样式支持代码分割：可以按需加载样式文件

## dumi dev 怎么执行的

```mermaid
flowchart TD
    A[执行 dumi dev 命令] --> B[初始化与配置加载]

    subgraph B [初始化与配置加载]
        B1[解析命令行参数] --> B2[读取环境变量]
        B2 --> B3[加载配置文件<br>如 .umirc.ts / .env]
    end

    B --> C{检查文档与组件源码}

    C --> D[启动开发服务器<br>（默认端口：8000）]

    D --> E[核心编译与构建流程]

    subgraph E [核心编译与构建流程]
        E1[编译 Markdown 为页面] --> E2[转译 JSX/TSX 组件 Demo]
        E2 --> E3[启动 Webpack Dev Server<br>（HMR/热更新）]
    end

    E --> F[打开浏览器，提供实时预览]
```

1. Dumi 初始化（.dumirc.ts）├─ 加载插件 (dumi-plugin-color-chunk) ├─ 注册自定义 TechStack (AntdReactTechStack)(.dumi/theme/plugin.ts) ├─ 扫描文档目录 (docs/) ├─ 扫描组件目录 (components/) ├─ 解析路由 ├─ 加载主题 (.dumi/theme/) ├─ 配置 Webpack/Mako 构建器 └─ 启动开发服务器

2. 插件 .dumi/theme/plugin.ts

- Dumi 框架约定式自动加载的插件文

```mermaid
graph TB
    A[Dumi 启动] --> B{扫描 .dumi/theme/plugin.ts}
    B -->|存在| C[自动加载插件]
    B -->|不存在| D[使用默认配置]

    C --> E[注册 AntdReactTechStack]
    C --> F[修改路由]
    C --> G[处理 HTML 导出]

    E --> E1[扫描 Markdown 中的代码]
    E1 --> E2[内联代码块 code-block]
    E1 --> E3[外部 Demo 文件 external]

    E2 --> E4[TS → JS 转换]
    E3 --> E5[读取 .tsx 和 .md 文件]
    E5 --> E6[解析多语言描述和样式]
    E6 --> E4

    E4 --> E7[生成 Previewer Props]
    E7 --> E8[渲染代码预览器]

    F --> F1[添加 /changelog 路由]
    F --> F2[添加 /changelog-cn 路由]

    G --> G1[提取 Emotion 样式]
    G1 --> G2[写入 style-antd.hash.css]
    G2 --> G3[在 HTML 中注入 link 标签]
    G3 --> G4[生成最终 HTML 文件]
```

## 最终文档界面上的导航栏是怎么配置的？
